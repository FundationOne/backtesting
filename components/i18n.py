"""
Internationalisation (i18n) module.
Provides translations for EN and DE with a simple t(key, lang) lookup.
"""

# ── Translation dictionary ─────────────────────────────────────────────
# Keys use dotted notation: <page/component>.<context>
# Values are dicts: {"en": "English text", "de": "German text"}

_TRANSLATIONS: dict[str, dict[str, str]] = {
    # ── Navigation / Main ───────────────────────────────────────────────
    "nav.tagline":              {"en": "Portfolio & Backtesting",    "de": "Portfolio & Backtesting"},
    "nav.portfolio_analysis":   {"en": "Portfolio Analysis",         "de": "Portfolio-Analyse"},
    "nav.backtesting":          {"en": "Backtesting",                "de": "Backtesting"},
    "nav.investment_simulator": {"en": "Investment Simulator",       "de": "Anlagesimulator"},
    "nav.bank_sync":            {"en": "Bank Account Sync",         "de": "Bankkonten-Sync"},
    "nav.riskbands":            {"en": "Exit Strategy Riskbands",   "de": "Ausstiegsstrategie Riskbands"},
    "nav.real_cost":            {"en": "The Real Cost",             "de": "Die wahren Kosten"},
    "nav.login":                {"en": "Login",                     "de": "Anmelden"},
    "nav.logout":               {"en": "Logout",                    "de": "Abmelden"},
    "nav.404_title":            {"en": "404 - Page Not Found",      "de": "404 – Seite nicht gefunden"},
    "nav.404_text":             {"en": "The page you're looking for doesn't exist.",
                                 "de": "Die gesuchte Seite existiert nicht."},

    # ── Auth ────────────────────────────────────────────────────────────
    "au.local_login":           {"en": "Local Login",               "de": "Lokale Anmeldung"},
    "au.browser_only":          {"en": "All data is stored exclusively in this local browser",
                                 "de": "Alle Daten werden ausschließlich in diesem Browser gespeichert"},
    "au.username":              {"en": "Username",                  "de": "Benutzername"},
    "au.password":              {"en": "Password",                  "de": "Passwort"},
    "au.login_btn":             {"en": "Login",                     "de": "Anmelden"},
    "au.register_btn":          {"en": "Register",                  "de": "Registrieren"},
    "au.no_account":            {"en": "No account? Enter credentials and click Register",
                                 "de": "Kein Konto? Zugangsdaten eingeben und Registrieren klicken"},
    "au.enter_creds":           {"en": "Enter username and password",
                                 "de": "Benutzername und Passwort eingeben"},
    "au.user_exists":           {"en": "User exists",              "de": "Benutzer existiert bereits"},
    "au.user_not_found":        {"en": "User not found",           "de": "Benutzer nicht gefunden"},
    "au.wrong_password":        {"en": "Wrong password",           "de": "Falsches Passwort"},
    "au.auth_error":            {"en": "Auth error",               "de": "Authentifizierungsfehler"},

    # ── Settings Modal ──────────────────────────────────────────────────
    "sm.title":                 {"en": "Settings",                 "de": "Einstellungen"},
    "sm.api_key_label":         {"en": "OpenAI API Key",           "de": "OpenAI API-Schlüssel"},
    "sm.api_key_help":          {"en": "Required for AI-powered rule generation",
                                 "de": "Erforderlich für KI-gestützte Regelgenerierung"},
    "sm.theme_label":           {"en": "Display Theme",            "de": "Anzeige-Design"},
    "sm.theme_help":            {"en": "Choose your preferred color scheme",
                                 "de": "Wähle dein bevorzugtes Farbschema"},
    "sm.light":                 {"en": "Light",                    "de": "Hell"},
    "sm.dark":                  {"en": "Dark",                     "de": "Dunkel"},
    "sm.done":                  {"en": "Done",                     "de": "Fertig"},

    # ── Portfolio Analysis ──────────────────────────────────────────────
    "pa.connect_tr":            {"en": "Connect to Trade Republic", "de": "Mit Trade Republic verbinden"},
    "pa.demo_account":          {"en": "DEMO ACCOUNT",             "de": "DEMO-KONTO"},
    "pa.demo_banner":           {"en": " — You are viewing sample data. ",
                                 "de": " — Du siehst Beispieldaten. "},
    "pa.demo_login":            {"en": "Log in",                   "de": "Anmelden"},
    "pa.demo_suffix":           {"en": " and sync your Trade Republic account to see your real portfolio.",
                                 "de": " und synchronisiere dein Trade Republic-Konto, um dein echtes Portfolio zu sehen."},
    "pa.sync":                  {"en": "Sync",                     "de": "Synchronisieren"},
    "pa.switch_demo":           {"en": "Switch to Demo Account",   "de": "Zum Demo-Konto wechseln"},
    "pa.switch_real":           {"en": "Switch to Real Account",   "de": "Zum echten Konto wechseln"},
    "pa.hide":                  {"en": "Hide",                     "de": "Ausblenden"},
    "pa.all":                   {"en": "All",                      "de": "Alle"},
    "pa.etfs":                  {"en": "ETFs",                     "de": "ETFs"},
    "pa.stocks":                {"en": "Stocks",                   "de": "Aktien"},
    "pa.crypto":                {"en": "Crypto",                   "de": "Krypto"},
    "pa.bonds":                 {"en": "Bonds",                    "de": "Anleihen"},
    "pa.cash":                  {"en": "Cash",                     "de": "Bargeld"},
    "pa.bench":                 {"en": "1 Bench.",                 "de": "1 Bench."},
    "pa.portfolio_value":       {"en": "Portfolio Value",          "de": "Portfoliowert"},
    "pa.invested":              {"en": "Invested",                 "de": "Investiert"},
    "pa.profit_loss":           {"en": "Profit/Loss",              "de": "Gewinn/Verlust"},
    "pa.1m_return":             {"en": "1M Return",                "de": "1M Rendite"},
    "pa.3m_return":             {"en": "3M Return",                "de": "3M Rendite"},
    "pa.ytd_return":            {"en": "YTD Return",               "de": "YTD Rendite"},
    "pa.total_return":          {"en": "Total Return",             "de": "Gesamtrendite"},
    "pa.value":                 {"en": "Value",                    "de": "Wert"},
    "pa.drawdown":              {"en": "Drawdown",                 "de": "Drawdown"},
    "pa.performance":           {"en": "Performance",              "de": "Performance"},
    "pa.perf_comparison":       {"en": "Performance Comparison",   "de": "Performance-Vergleich"},
    "pa.returns_summary":       {"en": "Returns Summary",          "de": "Renditeübersicht"},
    "pa.recent_activity":       {"en": "Recent Activity",          "de": "Letzte Aktivitäten"},
    "pa.securities":            {"en": "Securities",               "de": "Wertpapiere"},
    "pa.no_data":               {"en": "No data",                  "de": "Keine Daten"},
    "pa.portfolio":             {"en": "Portfolio",                 "de": "Portfolio"},
    "pa.none":                  {"en": "None",                     "de": "Keine"},
    "pa.all_assets":            {"en": "All Assets",               "de": "Alle Assets"},
    "pa.types":                 {"en": "{n} Types",                "de": "{n} Typen"},
    "pa.no_bench":              {"en": "No Bench.",                "de": "Kein Bench."},
    "pa.n_bench":               {"en": "{n} Bench.",               "de": "{n} Bench."},
    "pa.not_connected":         {"en": "Not connected",            "de": "Nicht verbunden"},
    "pa.n_holdings":            {"en": "{n} Holdings",             "de": "{n} Positionen"},
    "pa.synced_date":           {"en": "Synced {date}",            "de": "Sync {date}"},
    "pa.synced":                {"en": "Synced",                   "de": "Synchronisiert"},
    "pa.connected":             {"en": "Connected",                "de": "Verbunden"},
    "pa.no_data_synced":        {"en": "No data synced",           "de": "Keine Daten synchronisiert"},
    "pa.no_recent_activity":    {"en": "No recent activity",       "de": "Keine aktuellen Aktivitäten"},
    "pa.price_gains":           {"en": "Price Gains",              "de": "Kursgewinne"},
    "pa.dividends":             {"en": "Dividends (gross)",        "de": "Dividenden (brutto)"},
    "pa.interest":              {"en": "Interest (gross)",         "de": "Zinsen (brutto)"},
    "pa.realized_pl":           {"en": "Realized P/L",             "de": "Realisiert G/V"},
    "pa.fees":                  {"en": "Fees",                     "de": "Gebühren"},
    "pa.taxes":                 {"en": "Taxes",                    "de": "Steuern"},
    "pa.net_total":             {"en": "Net Total",                "de": "Netto Gesamt"},
    "pa.savings_plan":          {"en": "Savings Plan",             "de": "Sparplan"},
    "pa.buy":                   {"en": "Buy",                      "de": "Kauf"},
    "pa.sell":                  {"en": "Sell",                     "de": "Verkauf"},
    "pa.dividend":              {"en": "Dividend",                 "de": "Dividende"},
    "pa.interest_activity":     {"en": "Interest",                 "de": "Zinsen"},
    "pa.deposit":               {"en": "Deposit",                  "de": "Einzahlung"},
    "pa.withdrawal":            {"en": "Withdrawal",               "de": "Auszahlung"},
    "pa.tax":                   {"en": "Tax",                      "de": "Steuer"},
    "pa.fee":                   {"en": "Fee",                      "de": "Gebühr"},
    "pa.activity":              {"en": "Activity",                 "de": "Aktivität"},
    "pa.name":                  {"en": "Name",                     "de": "Name"},
    "pa.type":                  {"en": "Type",                     "de": "Typ"},
    "pa.shares":                {"en": "Shares",                   "de": "Anteile"},
    "pa.avg_price":             {"en": "Avg €",                    "de": "Ø €"},
    "pa.pl":                    {"en": "P/L",                      "de": "G/V"},
    "pa.pl_pct":                {"en": "P/L %",                    "de": "G/V %"},
    "pa.div":                   {"en": "Div.",                     "de": "Div."},
    "pa.alloc":                 {"en": "Alloc.",                   "de": "Anteil"},
    "pa.no_securities":         {"en": "No securities",            "de": "Keine Wertpapiere"},
    "pa.chart_empty":           {"en": "Connect to Trade Republic to see your portfolio",
                                 "de": "Verbinde Trade Republic, um dein Portfolio zu sehen"},
    "pa.chart_no_hist":         {"en": "Historical chart not available from Trade Republic",
                                 "de": "Historischer Chart von Trade Republic nicht verfügbar"},
    "pa.chart_no_range":        {"en": "No history data for selected range",
                                 "de": "Keine Daten für den gewählten Zeitraum"},
    "pa.yaxis_value":           {"en": "Portfolio Value (€)",      "de": "Portfoliowert (€)"},
    "pa.yaxis_return":          {"en": "Return (%)",               "de": "Rendite (%)"},
    "pa.yaxis_drawdown":        {"en": "Drawdown (%)",             "de": "Drawdown (%)"},
    "pa.added_capital":         {"en": "Added Capital",            "de": "Zugeführtes Kapital"},
    "pa.your_portfolio":        {"en": "Your Portfolio",           "de": "Dein Portfolio"},
    "pa.asset":                 {"en": "Asset",                    "de": "Asset"},
    "pa.total":                 {"en": "Total",                    "de": "Gesamt"},
    "pa.no_data_available":     {"en": "No data available",        "de": "Keine Daten verfügbar"},
    "pa.no_history_data":       {"en": "No history data",          "de": "Keine Verlaufsdaten"},
    "pa.show_values":           {"en": "Show Values",              "de": "Werte zeigen"},
    "pa.hide_values":           {"en": "Hide Values",              "de": "Werte ausblenden"},

    # ── Backtesting ─────────────────────────────────────────────────────
    "bt.title":                 {"en": "Backtesting",              "de": "Backtesting"},
    "bt.subtitle":              {"en": "Test trading strategies against historical data",
                                 "de": "Handelsstrategien mit historischen Daten testen"},
    "bt.asset":                 {"en": "Asset",                    "de": "Asset"},
    "bt.search_placeholder":    {"en": "Search asset… e.g. AAPL, BTC-USD, SPY",
                                 "de": "Asset suchen… z.B. AAPL, BTC-USD, SPY"},
    "bt.parameters":            {"en": "Parameters",               "de": "Parameter"},
    "bt.cash":                  {"en": "Cash ($)",                 "de": "Kapital ($)"},
    "bt.trade_size":            {"en": "Trade Size ($)",           "de": "Ordergröße ($)"},
    "bt.fee":                   {"en": "Fee ($)",                  "de": "Gebühr ($)"},
    "bt.tax":                   {"en": "Tax (%)",                  "de": "Steuer (%)"},
    "bt.start_date":            {"en": "Start Date",               "de": "Startdatum"},
    "bt.tax_method":            {"en": "Tax Method",               "de": "Steuermethode"},
    "bt.hold_period":           {"en": "Hold Period (days)",       "de": "Haltedauer (Tage)"},
    "bt.start_invested":        {"en": "Start fully invested",    "de": "Voll investiert starten"},
    "bt.lin":                   {"en": "Lin",                      "de": "Lin"},
    "bt.log":                   {"en": "Log",                      "de": "Log"},
    "bt.tx_history":            {"en": "Transaction History",      "de": "Transaktionsverlauf"},
    "bt.no_data_error":         {"en": "Could not load data for '{ticker}'.",
                                 "de": "Daten für '{ticker}' konnten nicht geladen werden."},
    "bt.lump_sum":              {"en": "Lump Sum & Hold",          "de": "Einmalanlage & Halten"},
    "bt.monthly_dca":           {"en": "Monthly DCA",              "de": "Monatlicher Sparplan"},
    "bt.portfolio_value":       {"en": "Portfolio Value",          "de": "Portfoliowert"},
    "bt.buy":                   {"en": "Buy",                      "de": "Kauf"},
    "bt.sell":                  {"en": "Sell",                     "de": "Verkauf"},
    "bt.backtest_results":      {"en": "Backtest Results",         "de": "Backtest-Ergebnisse"},
    "bt.price":                 {"en": "Price",                    "de": "Preis"},
    "bt.date":                  {"en": "Date",                     "de": "Datum"},
    "bt.portfolio_value_usd":   {"en": "Portfolio Value ($)",      "de": "Portfoliowert ($)"},

    # ── Portfolio Simulator ─────────────────────────────────────────────
    "ps.title":                 {"en": "Investment Simulator",      "de": "Anlagesimulator"},
    "ps.subtitle":              {"en": "Simulate long-term portfolio growth with withdrawals and taxes",
                                 "de": "Simuliere langfristiges Portfoliowachstum mit Entnahmen und Steuern"},
    "ps.params":                {"en": "Simulation Parameters",     "de": "Simulationsparameter"},
    "ps.starting_investment":   {"en": "Starting Investment",       "de": "Anfangsinvestition"},
    "ps.annual_growth":         {"en": "Annual Growth Rate",        "de": "Jährliche Wachstumsrate"},
    "ps.withdrawal_type":       {"en": "Withdrawal Type",           "de": "Entnahmeart"},
    "ps.fixed_sum":             {"en": " Fixed Sum (€)",            "de": " Fester Betrag (€)"},
    "ps.percentage":            {"en": " Percentage (%)",           "de": " Prozentsatz (%)"},
    "ps.annual_withdrawal":     {"en": "Annual Withdrawal",         "de": "Jährliche Entnahme"},
    "ps.time_frame":            {"en": "Simulation Time Frame",     "de": "Simulationszeitraum"},
    "ps.custom_years":          {"en": "Custom Years",              "de": "Eigene Jahre"},
    "ps.sp500_historical":      {"en": "S&P 500 Historical",       "de": "S&P 500 Historisch"},
    "ps.years_to_simulate":     {"en": "Years to Simulate",         "de": "Jahre simulieren"},
    "ps.sp500_start_year":      {"en": "Starting Year (S&P 500)",   "de": "Startjahr (S&P 500)"},
    "ps.tax_rate":              {"en": "Capital Gains Tax Rate",    "de": "Kapitalertragsteuer"},
    "ps.tax_method":            {"en": "Taxation Method",           "de": "Besteuerungsmethode"},
    "ps.fifo":                  {"en": "FIFO (First In, First Out)","de": "FIFO (First In, First Out)"},
    "ps.run_sim":               {"en": "Run Simulation",            "de": "Simulation starten"},
    "ps.projection":            {"en": "Portfolio Projection",      "de": "Portfolio-Projektion"},
    "ps.breakdown":             {"en": "Year-by-Year Breakdown",    "de": "Jahresübersicht"},
    "ps.year":                  {"en": "Year",                      "de": "Jahr"},
    "ps.amount_eur":            {"en": "Amount (€)",                "de": "Betrag (€)"},
    "ps.portfolio_value":       {"en": "Portfolio Value",           "de": "Portfoliowert"},
    "ps.growth":                {"en": "Growth",                    "de": "Wachstum"},
    "ps.withdrawals":           {"en": "Withdrawals",               "de": "Entnahmen"},
    "ps.taxes_paid":            {"en": "Taxes Paid",                "de": "Steuern gezahlt"},
    "ps.ending_value":          {"en": "Ending Value",              "de": "Endwert"},
    "ps.cost_basis":            {"en": "Cost Basis",                "de": "Einstandswert"},
    "ps.err_starting":          {"en": "Starting investment must be ≥ 0",
                                 "de": "Anfangsinvestition muss ≥ 0 sein"},
    "ps.err_growth":            {"en": "Growth rate is required",
                                 "de": "Wachstumsrate ist erforderlich"},
    "ps.err_withdrawal":        {"en": "Withdrawal must be ≥ 0",
                                 "de": "Entnahme muss ≥ 0 sein"},
    "ps.err_years":             {"en": "Years to simulate must be ≥ 1",
                                 "de": "Simulationsjahre müssen ≥ 1 sein"},

    # ── Riskbands ───────────────────────────────────────────────────────
    "rb.title":                 {"en": "Bitcoin Exit Strategy — Risk Bands",
                                 "de": "Bitcoin-Ausstiegsstrategie — Riskbands"},
    "rb.description":           {"en": "Plan your Bitcoin exit strategy by defining price bands where you progressively take profits. This tool simulates every possible path Bitcoin's price could take through your bands and shows you the expected outcome of each scenario.",
                                 "de": "Plane deine Bitcoin-Ausstiegsstrategie, indem du Preisbänder definierst, bei denen du schrittweise Gewinne mitnimmst. Dieses Tool simuliert jeden möglichen Preispfad durch deine Bänder und zeigt dir das erwartete Ergebnis jedes Szenarios."},
    "rb.how_it_works":          {"en": "How does this work?",       "de": "Wie funktioniert das?"},
    "rb.step1_title":           {"en": "Define your bands. ",       "de": "Definiere deine Bänder. "},
    "rb.step1_text":            {"en": "Set price levels (Stop Loss) at which you'd sell. For example, Band 1 at $79k, Band 5 at $167k.",
                                 "de": "Lege Preisniveaus (Stop Loss) fest, bei denen du verkaufen würdest. Zum Beispiel Band 1 bei $79k, Band 5 bei $167k."},
    "rb.step2_title":           {"en": "Set probabilities. ",       "de": "Setze Wahrscheinlichkeiten. "},
    "rb.step2_text":            {"en": "How likely is Bitcoin to reach each band? Lower bands are more likely (e.g. 100%) while higher bands are less likely (e.g. 20%).",
                                 "de": "Wie wahrscheinlich erreicht Bitcoin jedes Band? Niedrigere Bänder sind wahrscheinlicher (z.B. 100%), höhere weniger (z.B. 20%)."},
    "rb.step3_title":           {"en": "Push % controls how much BTC moves up. ",
                                 "de": "Push % bestimmt, wie viel BTC nach oben verschoben wird. "},
    "rb.step3_text":            {"en": "When Bitcoin's price rises from one band to the next, this percentage of your BTC in the current band gets moved (\"pushed\") up to that higher band — it is NOT sold yet, it just sits there waiting. If the price later drops back down, that BTC gets sold at the higher band's stop-loss price. ",
                                 "de": "Wenn Bitcoins Preis von einem Band zum nächsten steigt, wird dieser Prozentsatz deiner BTC im aktuellen Band nach oben verschoben (\"gepusht\") — es wird NICHT verkauft, sondern wartet dort. Fällt der Preis später zurück, wird dieses BTC zum Stop-Loss-Preis des höheren Bands verkauft. "},
    "rb.step3_example":         {"en": "Example: You have 1 BTC in Band 1 ($79k) and Push is 80%. Price rises to Band 2 ($88k) → 0.8 BTC moves up to Band 2, 0.2 BTC stays in Band 1. If the price then drops, that 0.8 BTC is sold at Band 2's $88k stop-loss.",
                                 "de": "Beispiel: Du hast 1 BTC in Band 1 ($79k) und Push ist 80%. Preis steigt auf Band 2 ($88k) → 0,8 BTC wandern zu Band 2, 0,2 BTC bleiben in Band 1. Fällt der Preis, wird 0,8 BTC zum $88k Stop-Loss von Band 2 verkauft."},
    "rb.step4_title":           {"en": "Read the results. ",        "de": "Lies die Ergebnisse. "},
    "rb.step4_text":            {"en": "The chart shows all possible price paths color-coded by total exit value (green = best, red = worst). The table lists every scenario ranked by outcome.",
                                 "de": "Der Chart zeigt alle möglichen Preispfade farbcodiert nach Gesamtausstiegswert (grün = bester, rot = schlechtester). Die Tabelle listet jedes Szenario nach Ergebnis sortiert."},
    "rb.risk_band":             {"en": "Risk Band",                 "de": "Riskband"},
    "rb.stop_loss":             {"en": "Stop Loss",                 "de": "Stop Loss"},
    "rb.prob":                  {"en": "Prob (%)",                  "de": "Wahrsch. (%)"},
    "rb.push":                  {"en": "Push (%)",                  "de": "Push (%)"},
    "rb.band_n":                {"en": "Band {n}",                  "de": "Band {n}"},
    "rb.band_config":           {"en": "Band Configuration",        "de": "Band-Konfiguration"},
    "rb.band_config_desc":      {"en": "Configure your price bands from lowest to highest. Adjust stop-loss prices, probability of reaching each band, and the % of holdings pushed to the next band.",
                                 "de": "Konfiguriere deine Preisbänder von niedrig nach hoch. Passe Stop-Loss-Preise, Wahrscheinlichkeiten und den %-Anteil an, der zum nächsten Band geschoben wird."},
    "rb.heatmap":               {"en": "Sensitivity Heatmap",       "de": "Sensitivitäts-Heatmap"},
    "rb.heatmap_hint":          {"en": "Click any cell to apply that combination of push % and probability spread.",
                                 "de": "Klicke auf eine Zelle, um diese Kombination aus Push % und Wahrscheinlichkeitsverteilung anzuwenden."},
    "rb.scenario_analysis":     {"en": "Scenario Analysis",         "de": "Szenario-Analyse"},
    "rb.scenario_desc":         {"en": "Each line represents a possible price path through your bands. Green lines are the most profitable outcomes, red lines the least.",
                                 "de": "Jede Linie stellt einen möglichen Preispfad durch deine Bänder dar. Grüne Linien = profitabelste, rote = am wenigsten profitabel."},
    "rb.all_scenarios":         {"en": "All Scenarios",             "de": "Alle Szenarien"},
    "rb.scenario":              {"en": "Scenario",                  "de": "Szenario"},
    "rb.total_value":           {"en": "Total Value",               "de": "Gesamtwert"},
    "rb.value_x_prob":          {"en": "Value × Probability",       "de": "Wert × Wahrscheinlichkeit"},
    "rb.chart_title":           {"en": "Risk Band Scenarios: Value at Each Step",
                                 "de": "Riskband-Szenarien: Wert bei jedem Schritt"},
    "rb.xaxis":                 {"en": "Step Number (with Offset)", "de": "Schrittnummer (mit Offset)"},
    "rb.yaxis":                 {"en": "Stop Loss Price (USD)",     "de": "Stop-Loss-Preis (USD)"},
    "rb.total_sum":             {"en": "TOTAL SUM: ${val}",         "de": "GESAMTSUMME: ${val}"},
    "rb.total_sum_prob":        {"en": "TOTAL SUM X PROBABILITY: ${val}",
                                 "de": "GESAMTSUMME × WAHRSCHEINLICHKEIT: ${val}"},
    "rb.push_pct":              {"en": "Push %",                    "de": "Push %"},
    "rb.prob_spread":           {"en": "Prob. Spread",              "de": "Wahrsch.-Verteilung"},

    # ── The Real Cost ───────────────────────────────────────────────────
    "rc.title":                 {"en": "The Real Cost",             "de": "Die wahren Kosten"},
    "rc.subtitle":              {"en": "Every dollar you spend today is a dollar that can't grow for tomorrow. See what your purchases truly cost in lost future wealth.",
                                 "de": "Jeder Euro, den du heute ausgibst, kann morgen nicht für dich wachsen. Sieh, was deine Käufe wirklich an entgangenem Vermögen kosten."},
    "rc.question":              {"en": "What would you like to buy?",
                                 "de": "Was möchtest du kaufen?"},
    "rc.or_enter_own":          {"en": "or enter your own",         "de": "oder eigenen Betrag eingeben"},
    "rc.item_placeholder":      {"en": "Item name (e.g. Mountain Bike)",
                                 "de": "Artikelname (z.B. Mountainbike)"},
    "rc.cost":                  {"en": "Cost",                      "de": "Kosten"},
    "rc.calculate":             {"en": "Calculate",                 "de": "Berechnen"},
    "rc.empty_state":           {"en": "Enter an item and cost above to see the real cost.",
                                 "de": "Gib oben einen Artikel und Preis ein, um die wahren Kosten zu sehen."},
    "rc.adjust":                {"en": "Adjust Your Assumptions",   "de": "Annahmen anpassen"},
    "rc.your_age":              {"en": "Your Age",                  "de": "Dein Alter"},
    "rc.years":                 {"en": "years",                     "de": "Jahre"},
    "rc.annual_growth":         {"en": "Annual Growth Rate",        "de": "Jährliche Wachstumsrate"},
    "rc.cash_cost":             {"en": "Cash Cost Now",             "de": "Aktueller Preis"},
    "rc.recalculate":           {"en": "Recalculate",               "de": "Neu berechnen"},
    "rc.really_costs":          {"en": "Your {name} really costs…", "de": "Dein(e) {name} kostet wirklich…"},
    "rc.true_cost":             {"en": "True Cost at Age 80",       "de": "Wahre Kosten mit 80 Jahren"},
    "rc.true_cost_sub":         {"en": "in {years_left} years at {growth}% growth",
                                 "de": "in {years_left} Jahren bei {growth}% Wachstum"},
    "rc.lost_wealth":           {"en": "Lost Future Wealth",        "de": "Entgangenes Vermögen"},
    "rc.lost_wealth_sub":       {"en": "money you'll never have",   "de": "Geld, das du nie haben wirst"},
    "rc.multiplier":            {"en": "Cost Multiplier",           "de": "Kostenmultiplikator"},
    "rc.multiplier_sub":        {"en": "every $1 spent = ${multiplier:.2f} lost",
                                 "de": "jeder $1 ausgegeben = ${multiplier:.2f} verloren"},
    "rc.insight":               {"en": "Instead of buying that {name} for {cost}, investing the money at {growth}% annual return would grow to {future_value} by the time you turn 80 — that's {lost} in lost wealth.",
                                 "de": "Anstatt {name} für {cost} zu kaufen, würde eine Investition des Geldes bei {growth}% jährlicher Rendite auf {future_value} wachsen, bis du 80 wirst — das sind {lost} an entgangenem Vermögen."},
    "rc.timeline":              {"en": "Growth Timeline",           "de": "Wachstumszeitachse"},
    "rc.year_n":                {"en": "Year {yr}",                 "de": "Jahr {yr}"},
    "rc.age_n":                 {"en": "Age {age}",                 "de": "Alter {age}"},
    "rc.purchase":              {"en": "Purchase",                  "de": "Kauf"},
    # Preset items
    "rc.starbucks":             {"en": "Starbucks Coffee",          "de": "Starbucks Kaffee"},
    "rc.flatscreen":            {"en": "Flatscreen TV",             "de": "Flachbildfernseher"},
    "rc.iphone":                {"en": "New iPhone",                "de": "Neues iPhone"},
    "rc.designer_bag":          {"en": "Designer Bag",              "de": "Designer-Tasche"},
    "rc.vacation":              {"en": "Vacation Trip",             "de": "Urlaubsreise"},
    "rc.used_car":              {"en": "Used Car",                  "de": "Gebrauchtwagen"},
    "rc.solar":                 {"en": "Solar Panels",              "de": "Solaranlage"},

    # ── Bank Sync ───────────────────────────────────────────────────────
    "bs.title":                 {"en": "Bank Account Sync",         "de": "Bankkonten-Sync"},
    "bs.subtitle":              {"en": "Connect your bank, categorise transactions, track recurring payments.",
                                 "de": "Verbinde dein Bankkonto, kategorisiere Transaktionen, verfolge wiederkehrende Zahlungen."},
    "bs.not_available":         {"en": "Bank Sync Not Available",   "de": "Bank-Sync nicht verfügbar"},
    "bs.not_configured":        {"en": "Bank account sync is not configured on this server. The administrator needs to set GC_SECRET_ID and GC_SECRET_KEY environment variables to enable PSD2 Open Banking connections.",
                                 "de": "Bank-Sync ist auf diesem Server nicht konfiguriert. Der Administrator muss die Umgebungsvariablen GC_SECRET_ID und GC_SECRET_KEY setzen, um PSD2-Open-Banking-Verbindungen zu aktivieren."},
    "bs.connect_bank":          {"en": "Connect Bank Account",      "de": "Bankkonto verbinden"},
    "bs.country":               {"en": "Country",                   "de": "Land"},
    "bs.bank":                  {"en": "Bank",                      "de": "Bank"},
    "bs.select_country_first":  {"en": "Select country first…",     "de": "Zuerst Land wählen…"},
    "bs.connect_btn":           {"en": "Connect",                   "de": "Verbinden"},
    "bs.connected_accounts":    {"en": "Connected Accounts",        "de": "Verbundene Konten"},
    "bs.refresh":               {"en": "Refresh",                   "de": "Aktualisieren"},
    "bs.no_accounts":           {"en": "No accounts connected yet.",
                                 "de": "Noch keine Konten verbunden."},
    "bs.manage_connections":    {"en": "Manage Bank Connections",    "de": "Bankverbindungen verwalten"},
    "bs.connections":           {"en": "Connections ",               "de": "Verbindungen "},
    "bs.close":                 {"en": "Close",                     "de": "Schließen"},
    "bs.openai_warning":        {"en": "AI categorisation requires an OpenAI API key. ",
                                 "de": "KI-Kategorisierung erfordert einen OpenAI API-Schlüssel. "},
    "bs.open_settings":         {"en": "Open Settings",             "de": "Einstellungen öffnen"},
    "bs.to_add_key":            {"en": " to add your key.",         "de": " um deinen Schlüssel hinzuzufügen."},
    "bs.recurring_rules":       {"en": "Recurring Rules",           "de": "Wiederkehrende Regeln"},
    "bs.new_rule":              {"en": "New Rule",                  "de": "Neue Regel"},
    "bs.rules_help":            {"en": "Rules automatically tag transactions matching a counterparty pattern (e.g. 'netflix') with a category and track whether they arrive on schedule.",
                                 "de": "Regeln markieren automatisch Transaktionen, die einem Empfängermuster (z.B. 'netflix') entsprechen, mit einer Kategorie und verfolgen, ob sie planmäßig eintreffen."},
    "bs.no_rules":              {"en": "No rules yet — click '+New Rule' to create one.",
                                 "de": "Noch keine Regeln — klicke '+Neue Regel' zum Erstellen."},
    "bs.payment_monitor":       {"en": "Payment Monitor",           "de": "Zahlungsmonitor"},
    "bs.monitoring_help":       {"en": "Compares your rules against actual transactions to spot missed or overdue recurring payments.",
                                 "de": "Vergleicht deine Regeln mit tatsächlichen Transaktionen, um fehlende oder überfällige Zahlungen zu erkennen."},
    "bs.add_rules_first":       {"en": "Add rules and sync transactions to see monitoring.",
                                 "de": "Regeln hinzufügen und Transaktionen synchronisieren, um die Überwachung zu sehen."},
    "bs.transactions":          {"en": "Transactions",              "de": "Transaktionen"},
    "bs.sync":                  {"en": "Sync",                      "de": "Sync"},
    "bs.ai_categorise":         {"en": "AI Categorise",             "de": "KI-Kategorisierung"},
    "bs.search":                {"en": "Search…",                   "de": "Suchen…"},
    "bs.all_categories":        {"en": "All Categories",            "de": "Alle Kategorien"},
    "bs.all_accounts":          {"en": "All Accounts",              "de": "Alle Konten"},
    "bs.in_out":                {"en": "In & Out",                  "de": "Ein & Aus"},
    "bs.income":                {"en": "Income ↑",                  "de": "Einnahmen ↑"},
    "bs.expense":               {"en": "Expense ↓",                 "de": "Ausgaben ↓"},
    "bs.connect_first":         {"en": "Connect a bank account and sync to see transactions.",
                                 "de": "Bankkonto verbinden und synchronisieren, um Transaktionen zu sehen."},
    "bs.create_rule":           {"en": "Create Transaction Rule",   "de": "Transaktionsregel erstellen"},
    "bs.rule_help":             {"en": "A rule automatically matches transactions by counterparty name and assigns a category. It also tracks their frequency so the Payment Monitor can alert you when a payment is missing.",
                                 "de": "Eine Regel gleicht Transaktionen automatisch nach Empfängername ab und weist eine Kategorie zu. Sie verfolgt auch die Häufigkeit, sodass der Zahlungsmonitor dich warnen kann, wenn eine Zahlung fehlt."},
    "bs.rule_name":             {"en": "Rule Name",                 "de": "Regelname"},
    "bs.rule_name_ph":          {"en": "e.g. Netflix Subscription", "de": "z.B. Netflix-Abo"},
    "bs.category":              {"en": "Category",                  "de": "Kategorie"},
    "bs.counterparty_pattern":  {"en": "Counterparty Pattern",      "de": "Empfängermuster"},
    "bs.pattern_ph":            {"en": "e.g. netflix, spotify...",   "de": "z.B. netflix, spotify..."},
    "bs.pattern_help":          {"en": "Matched case-insensitively against counterparty name and transaction description.",
                                 "de": "Wird ohne Groß-/Kleinschreibung gegen Empfängername und Transaktionsbeschreibung geprüft."},
    "bs.expected_amount":       {"en": "Expected Amount (€)",       "de": "Erwarteter Betrag (€)"},
    "bs.tolerance":             {"en": "Tolerance (%)",             "de": "Toleranz (%)"},
    "bs.frequency":             {"en": "Frequency",                 "de": "Häufigkeit"},
    "bs.weekly":                {"en": "Weekly",                    "de": "Wöchentlich"},
    "bs.biweekly":              {"en": "Bi-weekly",                 "de": "Zweiwöchentlich"},
    "bs.monthly":               {"en": "Monthly",                   "de": "Monatlich"},
    "bs.quarterly":             {"en": "Quarterly",                 "de": "Vierteljährlich"},
    "bs.yearly":                {"en": "Yearly",                    "de": "Jährlich"},
    "bs.cancel":                {"en": "Cancel",                    "de": "Abbrechen"},
    "bs.create_rule_btn":       {"en": "Create Rule",               "de": "Regel erstellen"},
    "bs.auth_gate":             {"en": "Please log in to access Bank Sync",
                                 "de": "Bitte anmelden, um Bank-Sync zu nutzen"},
    "bs.by_category":           {"en": "By Category",               "de": "Nach Kategorie"},
    "bs.3_months":              {"en": "3 months",                  "de": "3 Monate"},
    "bs.6_months":              {"en": "6 months",                  "de": "6 Monate"},
    "bs.12_months":             {"en": "12 months",                 "de": "12 Monate"},
    "bs.on_track":              {"en": "On Track",                  "de": "Planmäßig"},
    "bs.overdue":               {"en": "Overdue",                   "de": "Überfällig"},
    "bs.missing":               {"en": "Missing",                   "de": "Fehlend"},
    "bs.cumulative":            {"en": "Cumulative",                "de": "Kumuliert"},
    "bs.no_accounts_sync":      {"en": "No accounts to sync. Connect a bank first.",
                                 "de": "Keine Konten zum Synchronisieren. Verbinde zuerst eine Bank."},
    "bs.no_tx_match":           {"en": "No transactions match your filters.",
                                 "de": "Keine Transaktionen entsprechen deinen Filtern."},
    "bs.showing_n":             {"en": "Showing 200 of {n} transactions.",
                                 "de": "Zeige 200 von {n} Transaktionen."},
    "bs.no_tx_yet":             {"en": "No transactions yet. Sync to load.",
                                 "de": "Noch keine Transaktionen. Synchronisiere zum Laden."},
    "bs.set_api_key":           {"en": "Set your OpenAI API key in ",
                                 "de": "Setze deinen OpenAI API-Schlüssel in den "},
    "bs.settings":              {"en": "Settings",                  "de": "Einstellungen"},
    "bs.first":                 {"en": " first.",                   "de": " zuerst."},
    "bs.all_categorised":       {"en": "All transactions are already categorised!",
                                 "de": "Alle Transaktionen sind bereits kategorisiert!"},
    "bs.invalid_api_key":       {"en": "Invalid OpenAI API key. Check your key in Settings.",
                                 "de": "Ungültiger OpenAI API-Schlüssel. Überprüfe deinen Schlüssel in den Einstellungen."},
    "bs.name_pattern_required": {"en": "Name and pattern are required.",
                                 "de": "Name und Muster sind erforderlich."},
    "bs.no_rules_monitor":      {"en": "No recurring rules to monitor.",
                                 "de": "Keine wiederkehrenden Regeln zu überwachen."},
    "bs.bank_auth_ready":       {"en": "Bank authentication ready",
                                 "de": "Bankauthentifizierung bereit"},
    "bs.auth_instructions":     {"en": "Click the link below to authenticate with your bank via GoCardless's secure PSD2 interface. After completing authentication, click 'I've completed authentication'.",
                                 "de": "Klicke auf den folgenden Link, um dich bei deiner Bank über die sichere PSD2-Schnittstelle von GoCardless zu authentifizieren. Klicke nach Abschluss auf 'Authentifizierung abgeschlossen'."},
    "bs.open_bank_auth":        {"en": "Open bank authentication →",
                                 "de": "Bankauthentifizierung öffnen →"},
    "bs.auth_complete":         {"en": "I've completed authentication",
                                 "de": "Authentifizierung abgeschlossen"},
    "bs.any_amount":            {"en": "Any amount",                "de": "Beliebiger Betrag"},
    "bs.connect_info":          {"en": "Select your country and bank, then click 'Connect' to open your bank's secure login via GoCardless. After authenticating, you'll be redirected back here.",
                                 "de": "Wähle dein Land und deine Bank, klicke dann auf 'Verbinden', um das sichere Login deiner Bank über GoCardless zu öffnen. Nach der Authentifizierung wirst du hierher zurückgeleitet."},
    "bs.not_configured_creds":  {"en": "Set up GoCardless credentials first.",
                                 "de": "GoCardless-Zugangsdaten zuerst einrichten."},
    "bs.select_bank_first":     {"en": "Please select a bank first.",
                                 "de": "Bitte zuerst eine Bank auswählen."},
    "bs.conn_failed":           {"en": "Failed to create bank connection. Check credentials.",
                                 "de": "Bankverbindung konnte nicht erstellt werden. Zugangsdaten prüfen."},
    "bs.not_yet_linked":        {"en": "Bank connection not yet linked. The bank may still be processing — try clicking 'Refresh' in a moment.",
                                 "de": "Bankverbindung noch nicht verknüpft. Die Bank verarbeitet möglicherweise noch — versuche gleich 'Aktualisieren' zu klicken."},
    "bs.no_accounts_yet":       {"en": "No accounts found yet — try refreshing in a moment.",
                                 "de": "Noch keine Konten gefunden — versuche gleich zu aktualisieren."},
    "bs.auto_synced":           {"en": "Auto-synced {n_acct} new account(s). Total: {n_tx} transactions.",
                                 "de": "{n_acct} neue(s) Konto/Konten synchronisiert. Gesamt: {n_tx} Transaktionen."},
    "bs.synced_n":              {"en": "Synced {n_tx} transactions from {n_acct} account(s).",
                                 "de": "{n_tx} Transaktionen von {n_acct} Konto/Konten synchronisiert."},
    "bs.categorised_n":         {"en": "Categorised {n} transactions using AI.",
                                 "de": "{n} Transaktionen mittels KI kategorisiert."},
    "bs.cat_error":             {"en": "Categorisation error: {msg}",
                                 "de": "Kategorisierungsfehler: {msg}"},
    "bs.no_data":               {"en": "No data",                   "de": "Keine Daten"},
    "bs.hint_ai_categorise":    {"en": "No categories yet —\nclick AI Categorise",
                                 "de": "Noch keine Kategorien —\nklicke auf KI-Kategorisierung"},
    "bs.bank_not_configured":   {"en": "Bank sync not configured",  "de": "Bank-Sync nicht konfiguriert"},
    "bs.no_banks_found":        {"en": "No banks found for this country",
                                 "de": "Keine Banken für dieses Land gefunden"},
    "bs.last_date":             {"en": "Last: {date}",              "de": "Zuletzt: {date}"},
    "bs.never":                 {"en": "Never",                     "de": "Nie"},
    "bs.exp_amount":            {"en": "exp. €{amount}",            "de": "erw. €{amount}"},
    "bs.every_n_days":          {"en": "Every {n}d",                "de": "Alle {n} Tage"},

    # ── TR Connector ────────────────────────────────────────────────────
    "tr.not_connected":         {"en": "Not Connected",             "de": "Nicht verbunden"},
    "tr.secure_connection":     {"en": "Secure Connection",         "de": "Sichere Verbindung"},
    "tr.secure_desc":           {"en": "Connects to Trade Republic using the official app flow. You'll receive a 4-digit code in your TR app.",
                                 "de": "Verbindet sich über den offiziellen App-Flow mit Trade Republic. Du erhältst einen 4-stelligen Code in deiner TR-App."},
    "tr.saved_creds":           {"en": "Found saved credentials. ", "de": "Gespeicherte Zugangsdaten gefunden. "},
    "tr.click_reconnect":       {"en": "Click to reconnect",        "de": "Klicke zum erneuten Verbinden"},
    "tr.phone":                 {"en": "Phone Number",              "de": "Telefonnummer"},
    "tr.phone_ph":              {"en": "+49 XXX XXXXXXX",           "de": "+49 XXX XXXXXXX"},
    "tr.pin":                   {"en": "Trade Republic PIN",        "de": "Trade Republic PIN"},
    "tr.pin_ph":                {"en": "Your 4-digit TR PIN",       "de": "Deine 4-stellige TR-PIN"},
    "tr.send_code":             {"en": "Send Verification Code",    "de": "Verifizierungscode senden"},
    "tr.otp_instruction":       {"en": "Enter the 4-digit code from your Trade Republic app.",
                                 "de": "Gib den 4-stelligen Code aus deiner Trade Republic-App ein."},
    "tr.verify":                {"en": "Verify & Connect",          "de": "Verifizieren & Verbinden"},
    "tr.back":                  {"en": "Back",                      "de": "Zurück"},
    "tr.syncing":               {"en": "Syncing Portfolio Data",    "de": "Portfolio-Daten werden synchronisiert"},
    "tr.syncing_desc":          {"en": "Fetching your positions, transactions, and price history...",
                                 "de": "Positionen, Transaktionen und Kursverlauf werden geladen..."},
    "tr.step_connected":        {"en": "Connected to Trade Republic",
                                 "de": "Mit Trade Republic verbunden"},
    "tr.step_positions":        {"en": "Fetching portfolio positions...",
                                 "de": "Portfolio-Positionen werden geladen..."},
    "tr.step_transactions":     {"en": "Loading transaction history",
                                 "de": "Transaktionsverlauf wird geladen"},
    "tr.step_prices":           {"en": "Building price histories",  "de": "Kursverläufe werden erstellt"},
    "tr.large_portfolio":       {"en": "This may take 30-60 seconds for large portfolios.",
                                 "de": "Bei großen Portfolios kann dies 30-60 Sekunden dauern."},
    "tr.connected_success":     {"en": "Connected to Trade Republic!",
                                 "de": "Mit Trade Republic verbunden!"},
    "tr.refresh":               {"en": "Refresh",                   "de": "Aktualisieren"},
    "tr.disconnect":            {"en": "Disconnect",                "de": "Trennen"},
    "tr.portfolio_value":       {"en": "Portfolio Value",           "de": "Portfoliowert"},

    # ── Rule Builder ────────────────────────────────────────────────────
    "rl.trading_rules":         {"en": "Trading Rules",             "de": "Handelsregeln"},
    "rl.no_rules":              {"en": "No rules yet — click + Buy or + Sell to add one.",
                                 "de": "Noch keine Regeln — klicke + Kauf oder + Verkauf zum Hinzufügen."},
    "rl.run_backtest":          {"en": "Run Backtest",              "de": "Backtest starten"},
    "rl.quick_builder":         {"en": "Quick Builder",             "de": "Schnellbaukasten"},
    "rl.left_indicator":        {"en": "Left-hand indicator…",      "de": "Linker Indikator…"},
    "rl.op":                    {"en": "Op",                        "de": "Op"},
    "rl.custom_value":          {"en": "Custom value…",             "de": "Eigener Wert…"},
    "rl.right_indicator":       {"en": "Right-hand indicator or value…",
                                 "de": "Rechter Indikator oder Wert…"},
    "rl.value":                 {"en": "Value",                     "de": "Wert"},
    "rl.add_buy":               {"en": "Add as Buy",                "de": "Als Kauf hinzufügen"},
    "rl.add_sell":              {"en": "Add as Sell",               "de": "Als Verkauf hinzufügen"},
    "rl.buy":                   {"en": "Buy",                       "de": "Kauf"},
    "rl.sell":                  {"en": "Sell",                      "de": "Verkauf"},
    "rl.ai":                    {"en": "AI",                        "de": "KI"},
    "rl.save":                  {"en": "Save",                      "de": "Speichern"},
    "rl.load":                  {"en": "Load",                      "de": "Laden"},
    "rl.ai_title":              {"en": "AI Rule Generator",         "de": "KI-Regelgenerator"},
    "rl.ai_desc":               {"en": "Describe your trading rule in plain English and AI will convert it to code.",
                                 "de": "Beschreibe deine Handelsregel in einfachen Worten und die KI wandelt sie in Code um."},
    "rl.ai_placeholder":        {"en": "Example: Buy when the price is below the 4-year power law...",
                                 "de": "Beispiel: Kaufe, wenn der Preis unter dem 4-Jahres-Power-Law liegt..."},
    "rl.ai_tip":                {"en": "Tip: Be specific about indicators and conditions",
                                 "de": "Tipp: Sei spezifisch bei Indikatoren und Bedingungen"},
    "rl.cancel":                {"en": "Cancel",                    "de": "Abbrechen"},
    "rl.generate_rule":         {"en": "Generate Rule",             "de": "Regel generieren"},
    "rl.rule_guide":            {"en": "Rule Writing Guide",        "de": "Anleitung zum Regelschreiben"},
    "rl.got_it":                {"en": "Got it!",                   "de": "Verstanden!"},
    "rl.save_rules":            {"en": "Save Rules",                "de": "Regeln speichern"},
    "rl.rule_set_name":         {"en": "Rule Set Name",             "de": "Regelset-Name"},
    "rl.my_strategy":           {"en": "My Strategy...",            "de": "Meine Strategie..."},
    "rl.load_rules":            {"en": "Load Rules",                "de": "Regeln laden"},
    "rl.select_rule_set":       {"en": "Select Rule Set",           "de": "Regelset auswählen"},
    "rl.delete":                {"en": "Delete",                    "de": "Löschen"},
    "rl.current_price":         {"en": "Current Price",             "de": "Aktueller Preis"},
    "rl.bollinger_upper":       {"en": "Bollinger Upper",           "de": "Bollinger Oben"},
    "rl.bollinger_lower":       {"en": "Bollinger Lower",           "de": "Bollinger Unten"},
    "rl.last_highest":          {"en": "Last Highest",              "de": "Letztes Hoch"},
    "rl.last_lowest":           {"en": "Last Lowest",               "de": "Letztes Tief"},
    "rl.api_key_missing":       {"en": "OpenAI API key is missing. Set it in ",
                                 "de": "OpenAI API-Schlüssel fehlt. Setze ihn in den "},
    "rl.settings_gear":         {"en": " (gear icon in the sidebar).",
                                 "de": " (Zahnrad-Symbol in der Seitenleiste)."},
    "rl.invalid_key":           {"en": "Invalid OpenAI API key. Check your key in Settings (gear icon in the sidebar).",
                                 "de": "Ungültiger OpenAI API-Schlüssel. Überprüfe ihn in den Einstellungen (Zahnrad-Symbol in der Seitenleiste)."},
    "rl.ai_error":              {"en": "AI Error: ",                "de": "KI-Fehler: "},
}

# ── Exposed name mapping for page-specific lookups ──────────────────────

def t(key: str, lang: str = "en") -> str:
    """Look up a translation. Falls back to English, then to the key itself."""
    entry = _TRANSLATIONS.get(key)
    if entry is None:
        return key
    return entry.get(lang, entry.get("en", key))


def get_lang(lang_data) -> str:
    """Extract language string from a dcc.Store data value."""
    if isinstance(lang_data, dict):
        return lang_data.get("lang", "en")
    if isinstance(lang_data, str) and lang_data in ("en", "de"):
        return lang_data
    return "en"
